// @license           MIT
function r(...r){localStorage.getItem("debug")&&console.log(...r)}var e=Uint8Array,n=Uint16Array,t=Int32Array,o=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),f=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(r,e){for(var o=new n(31),a=0;a<31;++a)o[a]=e+=1<<r[a-1];var f=new t(o[30]);for(a=1;a<30;++a)for(var i=o[a];i<o[a+1];++i)f[i]=i-o[a]<<5|a;return{b:o,r:f}},l=i(o,2),u=l.b,c=l.r;u[28]=258,c[258]=28;var v=i(a,0).r,s=new n(32768);for(m=0;m<32768;++m)h=(61680&(h=(52428&(h=(43690&m)>>1|(21845&m)<<1))>>2|(13107&h)<<2))>>4|(3855&h)<<4,s[m]=((65280&h)>>8|(255&h)<<8)>>1;var h,d=function(r,e,t){for(var o=r.length,a=0,f=new n(e);a<o;++a)r[a]&&++f[r[a]-1];var i,l=new n(e);for(a=1;a<e;++a)l[a]=l[a-1]+f[a-1]<<1;if(t){i=new n(1<<e);var u=15-e;for(a=0;a<o;++a)if(r[a])for(var c=a<<4|r[a],v=e-r[a],h=l[r[a]-1]++<<v,d=h|(1<<v)-1;h<=d;++h)i[s[h]>>u]=c}else for(i=new n(o),a=0;a<o;++a)r[a]&&(i[a]=s[l[r[a]-1]++]>>15-r[a]);return i},w=new e(288);for(m=0;m<144;++m)w[m]=8;for(m=144;m<256;++m)w[m]=9;for(m=256;m<280;++m)w[m]=7;for(m=280;m<288;++m)w[m]=8;var g=new e(32);for(m=0;m<32;++m)g[m]=5;var m,y=d(w,9,0);d(w,9,1);var p=d(g,5,0);d(g,5,1);var b=function(r){return(r+7)/8|0},M=function(r,e,n){n<<=7&e;var t=e/8|0;r[t]|=n,r[t+1]|=n>>8},k=function(r,e,n){n<<=7&e;var t=e/8|0;r[t]|=n,r[t+1]|=n>>8,r[t+2]|=n>>16},x=function(r,t){for(var o=[],a=0;a<r.length;++a)r[a]&&o.push({s:a,f:r[a]});var f=o.length,i=o.slice();if(!f)return{t:U,l:0};if(1==f){var l=new e(o[0].s+1);return l[o[0].s]=1,{t:l,l:1}}o.sort((function(r,e){return r.f-e.f})),o.push({s:-1,f:25001});var u=o[0],c=o[1],v=0,s=1,h=2;for(o[0]={s:-1,f:u.f+c.f,l:u,r:c};s!=f-1;)u=o[o[v].f<o[h].f?v++:h++],c=o[v!=s&&o[v].f<o[h].f?v++:h++],o[s++]={s:-1,f:u.f+c.f,l:u,r:c};var d=i[0].s;for(a=1;a<f;++a)i[a].s>d&&(d=i[a].s);var w=new n(d+1),g=A(o[s-1],w,0);if(g>t){a=0;var m=0,y=g-t,p=1<<y;for(i.sort((function(r,e){return w[e.s]-w[r.s]||r.f-e.f}));a<f;++a){var b=i[a].s;if(!(w[b]>t))break;m+=p-(1<<g-w[b]),w[b]=t}for(m>>=y;m>0;){var M=i[a].s;w[M]<t?m-=1<<t-w[M]++-1:++a}for(;a>=0&&m;--a){var k=i[a].s;w[k]==t&&(--w[k],++m)}g=t}return{t:new e(w),l:g}},A=function(r,e,n){return-1==r.s?Math.max(A(r.l,e,n+1),A(r.r,e,n+1)):e[r.s]=n},T=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new n(++e),o=0,a=r[0],f=1,i=function(r){t[o++]=r},l=1;l<=e;++l)if(r[l]==a&&l!=e)++f;else{if(!a&&f>2){for(;f>138;f-=138)i(32754);f>2&&(i(f>10?f-11<<5|28690:f-3<<5|12305),f=0)}else if(f>3){for(i(a),--f;f>6;f-=6)i(8304);f>2&&(i(f-3<<5|8208),f=0)}for(;f--;)i(a);f=1,a=r[l]}return{c:t.subarray(0,o),n:e}},E=function(r,e){for(var n=0,t=0;t<e.length;++t)n+=r[t]*e[t];return n},C=function(r,e,n){var t=n.length,o=b(e+2);r[o]=255&t,r[o+1]=t>>8,r[o+2]=255^r[o],r[o+3]=255^r[o+1];for(var a=0;a<t;++a)r[o+a+4]=n[a];return 8*(o+4+t)},$=function(r,e,t,i,l,u,c,v,s,h,m){M(e,m++,t),++l[256];for(var b=x(l,15),A=b.t,$=b.l,S=x(u,15),U=S.t,I=S.l,L=T(A),j=L.c,q=L.n,D=T(U),H=D.c,O=D.n,P=new n(19),z=0;z<j.length;++z)++P[31&j[z]];for(z=0;z<H.length;++z)++P[31&H[z]];for(var W=x(P,7),_=W.t,B=W.l,F=19;F>4&&!_[f[F-1]];--F);var G,J,K,N,Q=h+5<<3,R=E(l,w)+E(u,g)+c,V=E(l,A)+E(u,U)+c+14+3*F+E(P,_)+2*P[16]+3*P[17]+7*P[18];if(s>=0&&Q<=R&&Q<=V)return C(e,m,r.subarray(s,s+h));if(M(e,m,1+(V<R)),m+=2,V<R){G=d(A,$,0),J=A,K=d(U,I,0),N=U;var X=d(_,B,0);M(e,m,q-257),M(e,m+5,O-1),M(e,m+10,F-4),m+=14;for(z=0;z<F;++z)M(e,m+3*z,_[f[z]]);m+=3*F;for(var Y=[j,H],Z=0;Z<2;++Z){var rr=Y[Z];for(z=0;z<rr.length;++z){var er=31&rr[z];M(e,m,X[er]),m+=_[er],er>15&&(M(e,m,rr[z]>>5&127),m+=rr[z]>>12)}}}else G=y,J=w,K=p,N=g;for(z=0;z<v;++z){var nr=i[z];if(nr>255){k(e,m,G[(er=nr>>18&31)+257]),m+=J[er+257],er>7&&(M(e,m,nr>>23&31),m+=o[er]);var tr=31&nr;k(e,m,K[tr]),m+=N[tr],tr>3&&(k(e,m,nr>>5&8191),m+=a[tr])}else k(e,m,G[nr]),m+=J[nr]}return k(e,m,G[256]),m+J[256]},S=new t([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),U=new e(0),I=function(r,f,i,l,u,s){var h=s.z||r.length,d=new e(l+h+5*(1+Math.ceil(h/7e3))+u),w=d.subarray(l,d.length-u),g=s.l,m=7&(s.r||0);if(f){m&&(w[0]=s.r>>3);for(var y=S[f-1],p=y>>13,M=8191&y,k=(1<<i)-1,x=s.p||new n(32768),A=s.h||new n(k+1),T=Math.ceil(i/3),E=2*T,U=function(e){return(r[e]^r[e+1]<<T^r[e+2]<<E)&k},I=new t(25e3),L=new n(288),j=new n(32),q=0,D=0,H=s.i||0,O=0,P=s.w||0,z=0;H+2<h;++H){var W=U(H),_=32767&H,B=A[W];if(x[_]=B,A[W]=_,P<=H){var F=h-H;if((q>7e3||O>24576)&&(F>423||!g)){m=$(r,w,0,I,L,j,D,O,z,H-z,m),O=q=D=0,z=H;for(var G=0;G<286;++G)L[G]=0;for(G=0;G<30;++G)j[G]=0}var J=2,K=0,N=M,Q=_-B&32767;if(F>2&&W==U(H-Q))for(var R=Math.min(p,F)-1,V=Math.min(32767,H),X=Math.min(258,F);Q<=V&&--N&&_!=B;){if(r[H+J]==r[H+J-Q]){for(var Y=0;Y<X&&r[H+Y]==r[H+Y-Q];++Y);if(Y>J){if(J=Y,K=Q,Y>R)break;var Z=Math.min(Q,Y-2),rr=0;for(G=0;G<Z;++G){var er=H-Q+G&32767,nr=er-x[er]&32767;nr>rr&&(rr=nr,B=er)}}}Q+=(_=B)-(B=x[_])&32767}if(K){I[O++]=268435456|c[J]<<18|v[K];var tr=31&c[J],or=31&v[K];D+=o[tr]+a[or],++L[257+tr],++j[or],P=H+J,++q}else I[O++]=r[H],++L[r[H]]}}for(H=Math.max(H,P);H<h;++H)I[O++]=r[H],++L[r[H]];m=$(r,w,g,I,L,j,D,O,z,H-z,m),g||(s.r=7&m|w[m/8|0]<<3,m-=7,s.h=A,s.p=x,s.i=H,s.w=P)}else{for(H=s.w||0;H<h+g;H+=65535){var ar=H+65535;ar>=h&&(w[m/8|0]=g,ar=h),m=C(w,m+1,r.subarray(H,ar))}s.i=h}return function(r,n,t){(null==n||n<0)&&(n=0),(null==t||t>r.length)&&(t=r.length);var o=new e(t-n);return o.set(r.subarray(n,t)),o}(d,0,l+b(m)+u)};!function(){for(var r=new Int32Array(256),e=0;e<256;++e){for(var n=e,t=9;--t;)n=(1&n&&-306674912)^n>>>1;r[e]=n}}();var L=function(){var r=1,e=0;return{p:function(n){for(var t=r,o=e,a=0|n.length,f=0;f!=a;){for(var i=Math.min(f+2655,a);f<i;++f)o+=t+=n[f];t=(65535&t)+15*(t>>16),o=(65535&o)+15*(o>>16)}r=t,e=o},d:function(){return(255&(r%=65521))<<24|(65280&r)<<8|(255&(e%=65521))<<8|e>>8}}},j=function(r,n,t,o,a){if(!a&&(a={l:1},n.dictionary)){var f=n.dictionary.subarray(-32768),i=new e(f.length+r.length);i.set(f),i.set(r,f.length),r=i,a.w=f.length}return I(r,null==n.level?6:n.level,null==n.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(r.length)))):12+n.mem,t,o,a)},q=function(r,e,n){for(;n;++e)r[e]=n,n>>>=8},D=function(r,e){var n=e.level,t=0==n?0:n<6?1:9==n?3:2;if(r[0]=120,r[1]=t<<6|(e.dictionary&&32),r[1]|=31-(r[0]<<8|r[1])%31,e.dictionary){var o=L();o.p(e.dictionary),q(r,2,o.d())}};typeof TextEncoder<"u"&&new TextEncoder;var H=typeof TextDecoder<"u"&&new TextDecoder;try{H.decode(U,{stream:!0}),1}catch(r){}const O={serverPath:"https://kroki.io/"};function P(e=null){const n=Array.from((e||document.body).querySelectorAll("*")).filter((r=>r.innerHTML.trim().startsWith("//kroki ")));for(const e of n){const n=e.textContent.split("\n"),t=n[0].replace("//kroki","").trim();if(!t.trim())continue;const o=n.filter(((r,e)=>0!==e)).join("\n");if(!o.trim())continue;const a=z(o,t,O),f=document.createElement("div");f.setAttribute("style","display: flex; flex-direction: row; place-content: center;"),f.setAttribute("notion-kroki","true"),f.innerHTML=`<object type="image/svg+xml" style="max-width: 100%;" data="${a}" />`;const i=e.parentElement.parentElement,l=i.querySelector("div[notion-kroki]");if(l){const e=l.firstElementChild.getAttribute("data");if(r(`preSvgUrl:${e}`),r(`svgUrl:${a}`),e===a)continue;i.removeChild(l)}i.appendChild(f)}}function z(e,n,t){r(`kroki render type: ${n}`),r(`kroki render content:\n${e}`);const o=`${t.serverPath+n}/svg/`;var a;const f=function(r){let e="";const n=32768;for(let t=0;t<r.length;t+=n)e+=String.fromCharCode(...r.subarray(t,t+n));return e}(function(r,e){e||(e={});var n=L();n.p(r);var t=j(r,e,e.dictionary?6:2,4);return D(t,e),q(t,t.length-4,n.d()),t}((a=e,(new TextEncoder).encode(a)),{level:9}));return o+btoa(f).replace(/\+/g,"-").replace(/\//g,"_")}const W=function(r,e){let n;return(...t)=>{clearTimeout(n),n=setTimeout((()=>{n=void 0,r(...t)}),e)}}(P,100);function _(r,e){W()}P(),"undefined"!=typeof MutationObserver&&new MutationObserver(_).observe(document,{childList:!0,subtree:!0});
//# sourceMappingURL=notion-kroki.user.js.map
